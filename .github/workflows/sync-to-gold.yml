name: Debug Token Generation

on:
  workflow_dispatch:

jobs:
  debug-token:
    name: Debug GitHub App Token
    runs-on: ubuntu-latest
    steps:
      - name: Check Secrets Exist
        run: |
          echo "APP_ID exists: ${{ secrets.APP_ID != '' }}"
          echo "PEMCONTENTS exists: ${{ secrets.PEMCONTENTS != '' }}"
          echo "APP_ID length: ${{ length(secrets.APP_ID) }}"
          echo "PEMCONTENTS starts with: ${{ secrets.PEMCONTENTS != '' && secrets.PEMCONTENTS[:30] }}..."
          
      - name: Try Token Generation
        id: app-token
        uses: actions/create-github-app-token@v1
        with:
          app-id: ${{ secrets.APP_ID }}
          private-key: ${{ secrets.PEMCONTENTS }}
          repository: Ali-Moatazz/gold-

      - name: Success Message
        if: success()
        run: echo "âœ… Token generated successfully!"
        
      - name: Show Token Info
        if: success()
        run: |
          echo "Token generated: ${{ steps.app-token.outputs.token != '' }}"
          echo "Token length: ${#{{ steps.app-token.outputs.token }}}"
